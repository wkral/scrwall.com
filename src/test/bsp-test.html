<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>BSP Tree Test</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
        <link rel="stylesheet" href="http://github.com/jquery/qunit/raw/master/qunit/qunit.css" type="text/css" media="screen" />
        <script type="text/javascript" src="http://github.com/jquery/qunit/raw/master/qunit/qunit.js"></script>
        <script type="text/javascript" src="../js/boxes.js"></script>
        <script type="text/javascript" src="../js/bsp-tree.js"></script>
        <script type="text/javascript">

var b1 = {left:0, right:9, top:10, bottom: 19};
var b2 = {left:10, right:19, top:10, bottom: 19};
var b3 = {left:0, right:9, top:20, bottom: 29};
var sb1 = {left:0, right:19, top: 20, bottom: 29};
var sb2 = {left:10, right:19, top: 10, bottom: 29};

test('Constructor', function() {
    var tree = BSPTree();
    ok(tree.head == null, 'New tree with no head');
});

test('Insert first box', function() {
    var tree = BSPTree();
    tree.put(b1);
    same(tree.head, b1, 'first box is the head');
});

test('Insert second box right', function () {
    var tree = BSPTree();
    tree.put(b1);
    tree.put(b2);
    same(tree.head.lt, b1, 'fisrt box is left of (less than) second');
    same(tree.head.gt, b2, 'second box is right of (greater than) first');
});
test('Insert second box left', function () {
    var tree = BSPTree();
    tree.put(b2);
    tree.put(b1);
    same(tree.head.lt, b1, 'second box is left of (less than) first');
    same(tree.head.gt, b2, 'first box is right of (greater than) second');
});
test('Insert second box below', function () {
    var tree = BSPTree();
    tree.put(b1);
    tree.put(b3);
    same(tree.head.gt, b1, 'first box is above (greater thann) second');
    same(tree.head.lt, b3, 'second box is below (less than) first');
});
test('Insert second box above', function () {
    var tree = BSPTree();
    tree.put(b3);
    tree.put(b1);
    same(tree.head.gt, b1, 'second box is above (greater than) first');
    same(tree.head.lt, b3, 'first box is below (less than) second');
});
test('Insert three nodes', function() {
    var tree = BSPTree();
    tree.put(b1);
    tree.put(b2);
    tree.put(b3);
    same(tree.head.lt.gt, b1, 'first box in correct position');
    same(tree.head.gt, b2, 'second box in correct position');
    same(tree.head.lt.lt, b3, 'third box in correct position');
});
test('Insert a box that gets split vertically', function() {
    var tree = BSPTree();
    tree.put(b1);
    tree.put(b2);
    tree.put(sb1);
    same(tree.head.lt.gt, b1, 'first box in correct position');
    same(tree.head.gt.gt, b2, 'second box in correct position');
    same(tree.head.lt.lt, {left: 0, right: 9, top: 20, bottom: 29}, 
        'left half of the split box in correct position');
    same(tree.head.gt.lt, {left: 10, right: 19, top: 20, bottom: 29},
        'right half of the split box in correct position');
});
test('Insert a box that gets split horizontally', function() {
    var tree = BSPTree();
    tree.put(b1);
    tree.put(b3);
    tree.put(sb2);
    same(tree.head.gt.lt, b1, 'first box in correct position');
    same(tree.head.lt.lt, b3, 'second box in correct position');
    same(tree.head.lt.gt, {left: 10, right: 19, top: 20, bottom: 29},
        'bottom half of split box in correct position');
    same(tree.head.gt.gt, {left: 10, right: 19, top: 10, bottom: 19},
        'bottom half of split box in correct position');
});
test('Finding adjacent box', function() {
    var tree = BSPTree();
    tree.put(b1);
    same(tree.find_adjacent(b2), [b1], 'Found the correct adjacent box');
    same(tree.find_adjacent(b3), [b1], 'Found the correct adjacent box');
});
test('Finding adjacent boxes vertical', function() {
    var tree = BSPTree();
    tree.put(b1);
    tree.put(b2);
    same(tree.find_adjacent(sb1), [b1, b2], 'Found the correct adjacent boxes');
});
test('Finding adjacent boxes horizontal', function() {
    var tree = BSPTree();
    tree.put(b1);
    tree.put(b3);
    same(tree.find_adjacent(sb2), [b3, b1], 'Found the correct adjacent boxes');
});
test('Inserting overlapping boxes', function() {
    var tree = BSPTree();
    tree.put(b1);
    try {
        tree.put({left: 5, right:15, top: 15, bottom: 25});
        ok(false, 'Failed: expected an exception');
    } catch (e) {
        equal(e, 'intersecting boxes not supported',
            'Caught the exception from overlapping');
    }
});
        </script>
    </head>
    <body>
        <h1 id="qunit-header">Binary Space Partition Tree Test</h1>
        <h2 id="qunit-banner"></h2>
        <h2 id="qunit-userAgent"></h2>
        <ol id="qunit-tests" />
    </body>
</html>
